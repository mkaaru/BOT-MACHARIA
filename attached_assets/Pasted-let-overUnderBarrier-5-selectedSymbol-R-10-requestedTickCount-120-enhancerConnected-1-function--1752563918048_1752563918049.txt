let overUnderBarrier=5,selectedSymbol="R_10",requestedTickCount=120,enhancerConnected=!1;!function(){let e=0;console.log("\uD83D\uDD0D Analyzer enhancer starting, looking for volatility analyzer...");let t=setInterval(()=>{if(e++,window.volatilityAnalyzer){console.log("✅ Analyzer enhancer connected to volatility-analyzer.js"),clearInterval(t),enhancerConnected=!0,o();return}if(window.getLastDigit&&window.tickHistory){console.log("✅ Analyzer enhancer connected to existing analyzer"),clearInterval(t),enhancerConnected=!0,o();return}e>=20&&(console.error("❌ Analyzer enhancer could not connect - volatility analyzer not found"),clearInterval(t))},500);function o(){window.addEventListener("message",function(e){if(!e.data||"object"!=typeof e.data)return;let{type:t}=e.data;switch(t){case"UPDATE_BARRIER":overUnderBarrier=parseInt(e.data.barrier,10),console.log(`Barrier value updated to: ${overUnderBarrier}`),i();break;case"UPDATE_SYMBOL":selectedSymbol=e.data.symbol,console.log(`Enhancer received symbol update: ${selectedSymbol}`);try{window.volatilityAnalyzer&&"function"==typeof window.volatilityAnalyzer.updateSymbol?window.volatilityAnalyzer.updateSymbol(selectedSymbol):"function"==typeof window.updateSymbol?window.updateSymbol(selectedSymbol):console.error("No updateSymbol function found on window or volatilityAnalyzer")}catch(e){console.error("Error updating symbol:",e)}break;case"UPDATE_TICK_COUNT":let o=e.data.tickCount||e.data.count;if(o&&!isNaN(o)){requestedTickCount=parseInt(o,10),console.log(`Enhancer received tick count update: ${requestedTickCount}`);try{window.volatilityAnalyzer&&"function"==typeof window.volatilityAnalyzer.updateTickCount?window.volatilityAnalyzer.updateTickCount(requestedTickCount):"function"==typeof window.updateTickCount?window.updateTickCount(requestedTickCount):console.error("No updateTickCount function found on window or volatilityAnalyzer")}catch(e){console.error("Error updating tick count:",e)}}break;case"REQUEST_ANALYSIS":i(e.data.strategyId)}});let e=window.updateUI;e&&(window.updateUI=function(){if(e.apply(this,arguments),window.tickHistory&&window.tickHistory.length>0){let e=window.tickHistory[window.tickHistory.length-1].quote.toFixed(window.decimalPlaces);window.postMessage({type:"PRICE_UPDATE",price:e,symbol:window.currentSymbol},"*")}i()})}function i(e=null){if(!window.tickHistory||0===window.tickHistory.length)return;let t=Array(10).fill(0);window.tickHistory.forEach(e=>{let o=window.getLastDigit(e.quote);t[o]++});let o=window.tickHistory.length,r=t.map(e=>(e/o*100).toFixed(2)),n=t.filter((e,t)=>t%2==0).reduce((e,t)=>e+t,0),a=t.filter((e,t)=>t%2!=0).reduce((e,t)=>e+t,0),d=(n/o*100).toFixed(2),l=(a/o*100).toFixed(2),c=0,s=0;for(let e=0;e<10;e++)e>=overUnderBarrier?c+=t[e]:s+=t[e];let w=(c/o*100).toFixed(2),y=(s/o*100).toFixed(2),u=window.tickHistory.slice(-10).map(e=>window.getLastDigit(e.quote)),p=u.map(e=>e%2==0?"E":"O"),g=u.map(e=>e>=overUnderBarrier?"O":"U"),f=1,v=u.length>0&&u[u.length-1]%2==0?"even":"odd";for(let e=u.length-2;e>=0;e--){let t=u[e]%2==0;if(t===(u[e+1]%2==0))f++;else break}if(!e||"rise-fall"===e){let e=0,t=0;for(let o=1;o<window.tickHistory.length;o++)window.tickHistory[o].quote>window.tickHistory[o-1].quote?e++:window.tickHistory[o].quote<window.tickHistory[o-1].quote&&t++;let i=(e/(o-1)*100).toFixed(2),r=(t/(o-1)*100).toFixed(2);window.postMessage({type:"ANALYSIS_DATA",strategyId:"rise-fall",data:{recommendation:parseFloat(i)>55?"Rise":parseFloat(r)>55?"Fall":null,confidence:Math.max(parseFloat(i),parseFloat(r)).toFixed(2),riseRatio:i,fallRatio:r}},"*")}if((!e||"even-odd"===e)&&window.postMessage({type:"ANALYSIS_DATA",strategyId:"even-odd",data:{recommendation:parseFloat(d)>55?"Even":parseFloat(l)>55?"Odd":null,confidence:Math.max(parseFloat(d),parseFloat(l)).toFixed(2),evenProbability:d,oddProbability:l}},"*"),(!e||"even-odd-2"===e)&&window.postMessage({type:"ANALYSIS_DATA",strategyId:"even-odd-2",data:{evenProbability:d,oddProbability:l,actualDigits:u,evenOddPattern:p,streak:f,streakType:v}},"*"),(!e||"over-under"===e)&&window.postMessage({type:"ANALYSIS_DATA",strategyId:"over-under",data:{recommendation:w>55?"Over":y>55?"Under":null,confidence:Math.max(w,y),overProbability:w,underProbability:y,barrier:overUnderBarrier}},"*"),(!e||"over-under-2"===e)&&window.postMessage({type:"ANALYSIS_DATA",strategyId:"over-under-2",data:{overProbability:w,underProbability:y,actualDigits:u,overUnderPattern:g,barrier:overUnderBarrier,digitPercentages:r,overUnderDefinition:{over:`≥${overUnderBarrier}`,under:`<${overUnderBarrier}`}}},"*"),!e||"matches-differs"===e){let e=0,i=0;t.forEach((t,o)=>{t>e&&(e=t,i=o)});let r=(e/o*100).toFixed(2),n=t.map((e,t)=>({digit:t,percentage:(e/o*100).toFixed(2),count:e})),a=window.tickHistory&&window.tickHistory.length>0?window.getLastDigit(window.tickHistory[window.tickHistory.length-1].quote):void 0;window.postMessage({type:"ANALYSIS_DATA",strategyId:"matches-differs",data:{recommendation:parseFloat(r)>15?"Matches":"Differs",confidence:(parseFloat(r)>15?parseFloat(r):100-parseFloat(r)).toFixed(2),target:i,mostFrequentProbability:r,digitFrequencies:n,currentLastDigit:a,totalTicks:o}},"*")}}}();