let overUnderBarrier=5,selectedSymbol="R_10",requestedTickCount=120,enhancerConnected=!1;!function(){let e=0;console.log("\uD83D\uDD0D Analyzer enhancer starting, looking for volatility analyzer...");let t=setInterval(()=>{if(e++,window.volatilityAnalyzer){console.log("✅ Analyzer enhancer connected to volatility-analyzer.js"),clearInterval(t),enhancerConnected=!0,o();return}if(window.getLastDigit&&window.tickHistory){console.log("✅ Analyzer enhancer connected to existing analyzer"),clearInterval(t),enhancerConnected=!0,o();return}e>=20&&(console.error("❌ Analyzer enhancer could not connect - volatility analyzer not found"),clearInterval(t))},500);function o(){window.addEventListener("message",function(e){if(!e.data||"object"!=typeof e.data)return;let{type:t}=e.data;switch(t){case"UPDATE_BARRIER":overUnderBarrier=parseInt(e.data.barrier,10),console.log(`Barrier value updated to: ${overUnderBarrier}`),i();break;case"UPDATE_SYMBOL":selectedSymbol=e.data.symbol,console.log(`Enhancer received symbol update: ${selectedSymbol}`);try{window.volatilityAnalyzer&&"function"==typeof window.volatilityAnalyzer.updateSymbol?window.volatilityAnalyzer.updateSymbol(selectedSymbol):"function"==typeof window.updateSymbol?window.updateSymbol(selectedSymbol):console.error("No updateSymbol function found on window or volatilityAnalyzer")}catch(e){console.error("Error updating symbol:",e)}break;case"UPDATE_TICK_COUNT":let o=e.data.tickCount||e.data.count;if(o&&!isNaN(o)){requestedTickCount=parseInt(o,10),console.log(`Enhancer received tick count update: ${requestedTickCount}`);try{window.volatilityAnalyzer&&"function"==typeof window.volatilityAnalyzer.updateTickCount?window.volatilityAnalyzer.updateTickCount(requestedTickCount):"function"==typeof window.updateTickCount?window.updateTickCount(requestedTickCount):console.error("No updateTickCount function found on window or volatilityAnalyzer")}catch(e){console.error("Error updating tick count:",e)}}break;case"REQUEST_ANALYSIS":i(e.data.strategyId)}});let e=window.updateUI;e&&(window.updateUI=function(){if(e.apply(this,arguments),window.tickHistory&&window.tickHistory.length>0){let e=window.tickHistory[window.tickHistory.length-1].quote.toFixed(window.decimalPlaces);window.postMessage({type:"PRICE_UPDATE",price:e,symbol:window.currentSymbol},"*")}i()})}function i(e=null){if(!window.tickHistory||0===window.tickHistory.length)return;let t=Array(10).fill(0);window.tickHistory.forEach(e=>{let o=window.getLastDigit(e.quote);t[o]++});let o=window.tickHistory.length,r=t.map(e=>(e/o*100).toFixed(2)),n=t.filter((e,t)=>t%2==0).reduce((e,t)=>e+t,0),a=t.filter((e,t)=>t%2!=0).reduce((e,t)=>e+t,0),d=(n/o*100).toFixed(2),l=(a/o*100).toFixed(2),c=0,s=0;for(let e=0;e<10;e++)e>=overUnderBarrier?c+=t[e]:s+=t[e];let w=(c/o*100).toFixed(2),y=(s/o*100).toFixed(2),u=window.tickHistory.slice(-10).map(e=>window.getLastDigit(e.quote)),p=u.map(e=>e%2==0?"E":"O"),g=u.map(e=>e>=overUnderBarrier?"O":"U"),f=1,v=u.length>0&&u[u.length-1]%2==0?"even":"odd";for(let e=u.length-2;e>=0;e--){let t=u[e]%2==0;if(t===(u[e+1]%2==0))f++;else break}if(!e||"rise-fall"===e){let e=0,t=0;for(let o=1;o<window.tickHistory.length;o++)window.tickHistory[o].quote>window.tickHistory[o-1].quote?e++:window.tickHistory[o].quote<window.tickHistory[o-1].quote&&t++;let i=(e/(o-1)*100).toFixed(2),r=(t/(o-1)*100).toFixed(2);window.postMessage({type:"ANALYSIS_DATA",strategyId:"rise-fall",data:{recommendation:parseFloat(i)>55?"Rise":parseFloat(r)>55?"Fall":null,confidence:Math.max(parseFloat(i),parseFloat(r)).toFixed(2),riseRatio:i,fallRatio:r}},"*")}if((!e||"even-odd"===e)&&window.postMessage({type:"ANALYSIS_DATA",strategyId:"even-odd",data:{recommendation:parseFloat(d)>55?"Even":parseFloat(l)>55?"Odd":null,confidence:Math.max(parseFloat(d),parseFloat(l)).toFixed(2),evenProbability:d,oddProbability:l}},"*"),(!e||"even-odd-2"===e)&&window.postMessage({type:"ANALYSIS_DATA",strategyId:"even-odd-2",data:{evenProbability:d,oddProbability:l,actualDigits:u,evenOddPattern:p,streak:f,streakType:v}},"*"),(!e||"over-under"===e)&&window.postMessage({type:"ANALYSIS_DATA",strategyId:"over-under",data:{recommendation:w>55?"Over":y>55?"Under":null,confidence:Math.max(w,y),overProbability:w,underProbability:y,barrier:overUnderBarrier}},"*"),(!e||"over-under-2"===e)&&window.postMessage({type:"ANALYSIS_DATA",strategyId:"over-under-2",data:{overProbability:w,underProbability:y,actualDigits:u,overUnderPattern:g,barrier:overUnderBarrier,digitPercentages:r,overUnderDefinition:{over:`≥${overUnderBarrier}`,under:`<${overUnderBarrier}`}}},"*"),!e||"matches-differs"===e){let e=0,i=0;t.forEach((t,o)=>{t>e&&(e=t,i=o)});let r=(e/o*100).toFixed(2),n=t.map((e,t)=>({digit:t,percentage:(e/o*100).toFixed(2),count:e})),a=window.tickHistory&&window.tickHistory.length>0?window.getLastDigit(window.tickHistory[window.tickHistory.length-1].quote):void 0;window.postMessage({type:"ANALYSIS_DATA",strategyId:"matches-differs",data:{recommendation:parseFloat(r)>15?"Matches":"Differs",confidence:(parseFloat(r)>15?parseFloat(r):100-parseFloat(r)).toFixed(2),target:i,mostFrequentProbability:r,digitFrequencies:n,currentLastDigit:a,totalTicks:o}},"*")}}}();




---------------------- and ---------------------------------




let derivWs,reconnectTimeout;let tickHistory=[],currentSymbol="R_10",tickCount=120,decimalPlaces=2,overUnderBarrier=5,isInitialized=!1,reconnectAttempts=0,MAX_RECONNECT_ATTEMPTS=5;function startWebSocket(){if(console.log("\uD83D\uDD0C Connecting to WebSocket API"),reconnectTimeout&&clearTimeout(reconnectTimeout),derivWs){try{derivWs.onclose=null,derivWs.close(),console.log("Closed existing connection")}catch(e){console.error("Error closing existing connection:",e)}derivWs=null}try{(derivWs=new WebSocket("wss://ws.binaryws.com/websockets/v3?app_id=68848")).onopen=function(){console.log("✅ WebSocket connection established"),reconnectAttempts=0,notifyConnectionStatus("connected"),setTimeout(()=>{try{derivWs&&derivWs.readyState===WebSocket.OPEN&&(console.log("Sending authorization request"),derivWs.send(JSON.stringify({app_id:68848})),requestTickHistory())}catch(e){console.error("Error during init requests:",e)}},500)},derivWs.onmessage=function(e){try{let t=JSON.parse(e.data);if(t.error){console.error("❌ WebSocket API error:",t.error),notifyConnectionStatus("error",t.error.message);return}if(t.history)console.log(`📊 Received history for ${currentSymbol}: ${t.history.prices.length} ticks`),tickHistory=t.history.prices.map((e,o)=>({time:t.history.times[o],quote:parseFloat(e)})),detectDecimalPlaces(),updateUI();else if(t.tick){let e=parseFloat(t.tick.quote);tickHistory.push({time:t.tick.epoch,quote:e}),tickHistory.length>tickCount&&tickHistory.shift(),updateUI()}else t.ping&&derivWs.send(JSON.stringify({pong:1}))}catch(e){console.error("Error processing message:",e)}},derivWs.onerror=function(e){console.error("❌ WebSocket error:",e),notifyConnectionStatus("error","Connection error"),scheduleReconnect()},derivWs.onclose=function(e){console.log("\uD83D\uDD04 WebSocket connection closed",e.code,e.reason),notifyConnectionStatus("disconnected"),scheduleReconnect()},window.derivWs=derivWs}catch(e){console.error("Failed to create WebSocket:",e),notifyConnectionStatus("error",e.message),scheduleReconnect()}}function scheduleReconnect(){if(++reconnectAttempts>5){console.log(`⚠️ Maximum reconnection attempts (5) reached. Stopping attempts.`),notifyConnectionStatus("error","Maximum reconnection attempts reached");return}let e=Math.min(1e3*Math.pow(1.5,reconnectAttempts-1),3e4);console.log(`🔄 Scheduling reconnect attempt ${reconnectAttempts} in ${e}ms`),reconnectTimeout=setTimeout(()=>{console.log(`🔄 Attempting to reconnect (${reconnectAttempts}/5)...`),startWebSocket()},e)}function requestTickHistory(){let e={ticks_history:currentSymbol,count:tickCount,end:"latest",style:"ticks",subscribe:1};if(derivWs&&derivWs.readyState===WebSocket.OPEN){console.log(`📡 Requesting tick history for ${currentSymbol} (${tickCount} ticks)`);try{derivWs.send(JSON.stringify(e))}catch(e){console.error("Error sending tick history request:",e),scheduleReconnect()}}else console.error("❌ WebSocket not ready to request history, readyState:",derivWs?derivWs.readyState:"undefined"),scheduleReconnect()}function updateSymbol(e){if(console.log(`🔄 Updating symbol: ${currentSymbol} -> ${e}`),currentSymbol===e&&derivWs&&derivWs.readyState===WebSocket.OPEN){console.log("Symbol unchanged, skipping reconnection");return}if(currentSymbol=e,tickHistory=[],derivWs&&derivWs.readyState===WebSocket.OPEN)try{console.log("Unsubscribing from current tick before changing symbol..."),derivWs.send(JSON.stringify({forget_all:"ticks"})),setTimeout(()=>requestTickHistory(),300)}catch(e){console.error("Error unsubscribing:",e),startWebSocket()}else startWebSocket()}function updateTickCount(e){if(console.log(`🔄 Updating tick count: ${tickCount} -> ${e}`),isNaN(e)||e<=0){console.error("Invalid tick count:",e);return}if(tickCount=e,tickHistory=[],derivWs&&derivWs.readyState===WebSocket.OPEN)try{console.log("Unsubscribing before changing tick count..."),derivWs.send(JSON.stringify({forget_all:"ticks"})),setTimeout(()=>requestTickHistory(),300)}catch(e){console.error("Error unsubscribing:",e),startWebSocket()}else startWebSocket()}function updateBarrier(e){console.log(`🔄 Updating barrier: ${overUnderBarrier} -> ${e}`),overUnderBarrier=e,updateUI()}function detectDecimalPlaces(){if(0!==tickHistory.length)decimalPlaces=Math.max(...tickHistory.map(e=>(e.quote.toString().split(".")[1]||"").length),2)}function getLastDigit(e){let t=e.toString().split(".")[1]||"";for(;t.length<decimalPlaces;)t+="0";return Number(t.slice(-1))}function getStatus(){return{connected:derivWs&&derivWs.readyState===WebSocket.OPEN,symbol:currentSymbol,tickCount:tickCount,dataAvailable:tickHistory.length>0,lastUpdate:Date.now()}}function notifyConnectionStatus(e,t=null){window.postMessage({type:"ANALYZER_CONNECTION_STATUS",status:e,error:t},"*")}function updateUI(){if(0===tickHistory.length){console.warn("⚠️ No tick history available for analysis");return}let e=tickHistory[tickHistory.length-1].quote.toFixed(decimalPlaces);window.postMessage({type:"PRICE_UPDATE",price:e,symbol:currentSymbol},"*"),sendAnalysisData()}function handleMessages(e){if(!e.data||"object"!=typeof e.data)return;let{type:t}=e.data;switch(t){case"UPDATE_SYMBOL":e.data.symbol&&(console.log("Received symbol update request:",e.data.symbol),updateSymbol(e.data.symbol));break;case"UPDATE_TICK_COUNT":let o=e.data.tickCount||e.data.count;o&&!isNaN(o)&&(console.log("Received tick count update request:",o),updateTickCount(parseInt(o,10)));break;case"UPDATE_BARRIER":e.data.barrier&&!isNaN(e.data.barrier)&&updateBarrier(parseInt(e.data.barrier,10));break;case"REQUEST_ANALYSIS":sendAnalysisData(e.data.strategyId);break;case"REQUEST_STATUS":window.postMessage({type:"ANALYZER_STATUS",status:getStatus()},"*")}}function sendAnalysisData(e=null){if(!tickHistory||0===tickHistory.length){console.warn("⚠️ No data available for analysis");return}try{let t=Array(10).fill(0);tickHistory.forEach(e=>{let o=getLastDigit(e.quote);t[o]++});let o=tickHistory.length,r=t.map(e=>(e/o*100).toFixed(2)),i=t.filter((e,t)=>t%2==0).reduce((e,t)=>e+t,0),n=t.filter((e,t)=>t%2!=0).reduce((e,t)=>e+t,0),s=(i/o*100).toFixed(2),a=(n/o*100).toFixed(2),c=0,l=0;for(let e=0;e<10;e++)e>=overUnderBarrier?c+=t[e]:l+=t[e];let d=(c/o*100).toFixed(2),u=(l/o*100).toFixed(2),y=tickHistory.slice(-10).map(e=>getLastDigit(e.quote)),g=y.map(e=>e%2==0?"E":"O"),p=y.map(e=>e>=overUnderBarrier?"O":"U"),b=1,k=y.length>0&&y[y.length-1]%2==0?"even":"odd";for(let e=y.length-2;e>=0;e--){let t=y[e]%2==0,o=y[e+1]%2==0;if(t===o)b++;else break}if(!e||"rise-fall"===e){let e=0,t=0;for(let o=1;o<tickHistory.length;o++)tickHistory[o].quote>tickHistory[o-1].quote?e++:tickHistory[o].quote<tickHistory[o-1].quote&&t++;let r=(e/(o-1)*100).toFixed(2),i=(t/(o-1)*100).toFixed(2);window.postMessage({type:"ANALYSIS_DATA",strategyId:"rise-fall",data:{recommendation:parseFloat(r)>55?"Rise":parseFloat(i)>55?"Fall":null,confidence:Math.max(parseFloat(r),parseFloat(i)).toFixed(2),riseRatio:r,fallRatio:i}},"*"),console.log(`📊 Rise/Fall analysis sent: Rise=${r}%, Fall=${i}%`)}if((!e||"even-odd"===e)&&(window.postMessage({type:"ANALYSIS_DATA",strategyId:"even-odd",data:{recommendation:parseFloat(s)>55?"Even":parseFloat(a)>55?"Odd":null,confidence:Math.max(parseFloat(s),parseFloat(a)).toFixed(2),evenProbability:s,oddProbability:a}},"*"),console.log(`📊 Even/Odd analysis sent: Even=${s}%, Odd=${a}%`)),(!e||"even-odd-2"===e)&&(window.postMessage({type:"ANALYSIS_DATA",strategyId:"even-odd-2",data:{evenProbability:s,oddProbability:a,actualDigits:y,evenOddPattern:g,streak:b,streakType:k}},"*"),console.log(`📊 Even/Odd-2 analysis sent: Pattern=${g.join("")}`)),(!e||"over-under"===e)&&(window.postMessage({type:"ANALYSIS_DATA",strategyId:"over-under",data:{recommendation:d>55?"Over":u>55?"Under":null,confidence:Math.max(d,u).toFixed(2),overProbability:d,underProbability:u,barrier:overUnderBarrier}},"*"),console.log(`📊 Over/Under analysis sent: Over=${d}%, Under=${u}%, Barrier=${overUnderBarrier}`)),(!e||"over-under-2"===e)&&(window.postMessage({type:"ANALYSIS_DATA",strategyId:"over-under-2",data:{overProbability:d,underProbability:u,actualDigits:y,overUnderPattern:p,barrier:overUnderBarrier,digitPercentages:r}},"*"),console.log(`📊 Over/Under-2 analysis sent: Pattern=${p.join("")}`)),!e||"matches-differs"===e){let e=0,r=0;t.forEach((t,o)=>{t>e&&(e=t,r=o)});let i=(e/o*100).toFixed(2),n=t.map((e,t)=>({digit:t,percentage:(e/o*100).toFixed(2),count:e})),s=tickHistory&&tickHistory.length>0?getLastDigit(tickHistory[tickHistory.length-1].quote):void 0;window.postMessage({type:"ANALYSIS_DATA",strategyId:"matches-differs",data:{recommendation:parseFloat(i)>15?"Matches":"Differs",confidence:(parseFloat(i)>15?parseFloat(i):100-parseFloat(i)).toFixed(2),target:r,mostFrequentProbability:i,digitFrequencies:n,currentLastDigit:s,totalTicks:o}},"*"),console.log(`📊 Matches/Differs analysis sent: Target=${r}, Current=${s}, Probability=${i}%`)}}catch(e){console.error("❌ Error in sendAnalysisData:",e)}}window.initVolatilityAnalyzer=function(){!isInitialized&&(isInitialized=!0,console.log("\uD83D\uDE80 Initializing volatility analyzer"),startWebSocket(),window.addEventListener("message",handleMessages),window.volatilityAnalyzer={updateSymbol:updateSymbol,updateTickCount:updateTickCount,updateBarrier:updateBarrier,getStatus:getStatus,reconnect:startWebSocket},window.derivWs=derivWs,window.tickHistory=tickHistory,window.getLastDigit=getLastDigit,window.updateUI=updateUI,window.updateSymbol=updateSymbol,window.updateTickCount=updateTickCount,window.decimalPlaces=decimalPlaces,window.currentSymbol=currentSymbol)},window.initVolatilityAnalyzer();
