
<xml xmlns="https://developers.google.com/blockly/xml">
  <variables>
    <variable id="v_base_stake">base_stake</variable>
    <variable id="v_recovery_mult">recovery_mult</variable>
    <variable id="v_max_recoveries">max_recoveries</variable>
    <variable id="v_session_loss_limit">session_loss_limit</variable>
    <variable id="v_current_recovery">current_recovery</variable>
    <variable id="v_last_digit">last_digit</variable>
    <variable id="v_last_side">last_side</variable>
    <variable id="v_start_bal">starting_balance</variable>
    <variable id="v_chosen_digit">chosen_digit</variable>
    <variable id="v_chosen_contract">chosen_contract</variable>
  </variables>
  <block type="controls_if" x="8" y="8" id="init">
    <value name="IF0">
      <block type="logic_boolean" id="true1"><field name="BOOL">TRUE</field></block>
    </value>
    <statement name="DO0">
      <block type="variables_set" id="set_base">
        <field name="VAR" id="v_base_stake">base_stake</field>
        <value name="VALUE"><block type="math_number" id="n1"><field name="NUM">1</field></block></value>
        <next>
          <block type="variables_set" id="set_mult">
            <field name="VAR" id="v_recovery_mult">recovery_mult</field>
            <value name="VALUE"><block type="math_number" id="n2"><field name="NUM">2</field></block></value>
            <next>
              <block type="variables_set" id="set_max">
                <field name="VAR" id="v_max_recoveries">max_recoveries</field>
                <value name="VALUE"><block type="math_number" id="n3"><field name="NUM">4</field></block></value>
                <next>
                  <block type="variables_set" id="set_sess">
                    <field name="VAR" id="v_session_loss_limit">session_loss_limit</field>
                    <value name="VALUE"><block type="math_number" id="n4"><field name="NUM">-50</field></block></value>
                    <next>
                      <block type="variables_set" id="set_curr">
                        <field name="VAR" id="v_current_recovery">current_recovery</field>
                        <value name="VALUE"><block type="math_number" id="n5"><field name="NUM">0</field></block></value>
                        <next>
                          <block type="variables_set" id="set_last_digit">
                            <field name="VAR" id="v_last_digit">last_digit</field>
                            <value name="VALUE"><block type="math_number" id="n6"><field name="NUM">-1</field></block></value>
                            <next>
                              <block type="variables_set" id="set_last_side">
                                <field name="VAR" id="v_last_side">last_side</field>
                                <value name="VALUE"><block type="text" id="text1"><field name="TEXT"></field></block></value>
                                <next>
                                  <block type="variables_set" id="set_start">
                                    <field name="VAR" id="v_start_bal">starting_balance</field>
                                    <value name="VALUE"><block type="balance" id="balance1"></block></value>
                                  </block>
                                </next>
                              </block>
                            </next>
                          </block>
                        </next>
                      </block>
                    </next>
                  </block>
                </next>
              </block>
            </next>
          </block>
        </next>
      </block>
    </statement>
    <next>
      <block type="procedures_defnoreturn" id="choose_best">
        <field name="NAME">choose_best</field>
        <statement name="STACK">
          <block type="controls_if" id="if_best">
            <mutation elseif="1"></mutation>
            <value name="IF0">
              <block type="logic_compare" id="comp1">
                <field name="OP">EQ</field>
                <value name="A"><block type="math_random_int" id="rand1">
                  <value name="FROM"><block type="math_number" id="n7"><field name="NUM">1</field></block></value>
                  <value name="TO"><block type="math_number" id="n8"><field name="NUM">100</field></block></value>
                </block></value>
                <value name="B"><block type="math_number" id="n9"><field name="NUM">1</field></block></value>
              </block>
            </value>
            <statement name="DO0">
              <block type="variables_set" id="set_digit1">
                <field name="VAR" id="v_chosen_digit">chosen_digit</field>
                <value name="VALUE"><block type="math_number" id="n10"><field name="NUM">1</field></block></value>
                <next>
                  <block type="variables_set" id="set_contract1">
                    <field name="VAR" id="v_chosen_contract">chosen_contract</field>
                    <value name="VALUE"><block type="text" id="text2"><field name="TEXT">DIGITOVER</field></block></value>
                  </block>
                </next>
              </block>
            </statement>
            <value name="IF1">
              <block type="logic_boolean" id="true2"><field name="BOOL">TRUE</field></block>
            </value>
            <statement name="DO1">
              <block type="variables_set" id="set_digit2">
                <field name="VAR" id="v_chosen_digit">chosen_digit</field>
                <value name="VALUE"><block type="math_number" id="n11"><field name="NUM">8</field></block></value>
                <next>
                  <block type="variables_set" id="set_contract2">
                    <field name="VAR" id="v_chosen_contract">chosen_contract</field>
                    <value name="VALUE"><block type="text" id="text3"><field name="TEXT">DIGITUNDER</field></block></value>
                  </block>
                </next>
              </block>
            </statement>
          </block>
        </statement>
      </block>
    </next>
  </block>
  
  <block type="procedures_defnoreturn" id="choose_next_best" x="8" y="300">
    <field name="NAME">choose_next_best</field>
    <statement name="STACK">
      <block type="controls_if" id="if_next_best">
        <mutation elseif="2" else="1"></mutation>
        <value name="IF0">
          <block type="logic_operation" id="and1">
            <field name="OP">AND</field>
            <value name="A">
              <block type="logic_compare" id="comp2">
                <field name="OP">NEQ</field>
                <value name="A"><block type="variables_get" id="get_last_digit1"><field name="VAR" id="v_last_digit">last_digit</field></block></value>
                <value name="B"><block type="math_number" id="n12"><field name="NUM">8</field></block></value>
              </block>
            </value>
            <value name="B">
              <block type="logic_compare" id="comp3">
                <field name="OP">NEQ</field>
                <value name="A"><block type="variables_get" id="get_last_side1"><field name="VAR" id="v_last_side">last_side</field></block></value>
                <value name="B"><block type="text" id="text4"><field name="TEXT">UNDER</field></block></value>
              </block>
            </value>
          </block>
        </value>
        <statement name="DO0">
          <block type="variables_set" id="set_digit3">
            <field name="VAR" id="v_chosen_digit">chosen_digit</field>
            <value name="VALUE"><block type="math_number" id="n13"><field name="NUM">8</field></block></value>
            <next>
              <block type="variables_set" id="set_contract3">
                <field name="VAR" id="v_chosen_contract">chosen_contract</field>
                <value name="VALUE"><block type="text" id="text5"><field name="TEXT">DIGITUNDER</field></block></value>
              </block>
            </next>
          </block>
        </statement>
        <value name="IF1">
          <block type="logic_operation" id="and2">
            <field name="OP">AND</field>
            <value name="A">
              <block type="logic_compare" id="comp4">
                <field name="OP">NEQ</field>
                <value name="A"><block type="variables_get" id="get_last_digit2"><field name="VAR" id="v_last_digit">last_digit</field></block></value>
                <value name="B"><block type="math_number" id="n14"><field name="NUM">7</field></block></value>
              </block>
            </value>
            <value name="B">
              <block type="logic_compare" id="comp5">
                <field name="OP">NEQ</field>
                <value name="A"><block type="variables_get" id="get_last_side2"><field name="VAR" id="v_last_side">last_side</field></block></value>
                <value name="B"><block type="text" id="text6"><field name="TEXT">UNDER</field></block></value>
              </block>
            </value>
          </block>
        </value>
        <statement name="DO1">
          <block type="variables_set" id="set_digit4">
            <field name="VAR" id="v_chosen_digit">chosen_digit</field>
            <value name="VALUE"><block type="math_number" id="n15"><field name="NUM">7</field></block></value>
            <next>
              <block type="variables_set" id="set_contract4">
                <field name="VAR" id="v_chosen_contract">chosen_contract</field>
                <value name="VALUE"><block type="text" id="text7"><field name="TEXT">DIGITUNDER</field></block></value>
              </block>
            </next>
          </block>
        </statement>
        <value name="IF2">
          <block type="logic_operation" id="and3">
            <field name="OP">AND</field>
            <value name="A">
              <block type="logic_compare" id="comp6">
                <field name="OP">NEQ</field>
                <value name="A"><block type="variables_get" id="get_last_digit3"><field name="VAR" id="v_last_digit">last_digit</field></block></value>
                <value name="B"><block type="math_number" id="n16"><field name="NUM">1</field></block></value>
              </block>
            </value>
            <value name="B">
              <block type="logic_compare" id="comp7">
                <field name="OP">NEQ</field>
                <value name="A"><block type="variables_get" id="get_last_side3"><field name="VAR" id="v_last_side">last_side</field></block></value>
                <value name="B"><block type="text" id="text8"><field name="TEXT">OVER</field></block></value>
              </block>
            </value>
          </block>
        </value>
        <statement name="DO2">
          <block type="variables_set" id="set_digit5">
            <field name="VAR" id="v_chosen_digit">chosen_digit</field>
            <value name="VALUE"><block type="math_number" id="n17"><field name="NUM">1</field></block></value>
            <next>
              <block type="variables_set" id="set_contract5">
                <field name="VAR" id="v_chosen_contract">chosen_contract</field>
                <value name="VALUE"><block type="text" id="text9"><field name="TEXT">DIGITOVER</field></block></value>
              </block>
            </next>
          </block>
        </statement>
        <statement name="ELSE">
          <block type="procedures_callnoreturn" id="call_choose_best">
            <mutation name="choose_best"></mutation>
          </block>
        </statement>
      </block>
    </statement>
  </block>

  <block type="trade_definition" id="trade_def" x="8" y="600">
    <field name="MARKET">synthetic_index</field>
    <field name="SUBMARKET">random_daily</field>
    <field name="SYMBOL">R_100</field>
    <value name="TRADETYPECAT">
      <block type="tradetypecat" id="trade_cat">
        <field name="TRADETYPECAT_LIST">digits</field>
      </block>
    </value>
    <value name="TRADETYPE">
      <block type="variables_get" id="get_contract">
        <field name="VAR" id="v_chosen_contract">chosen_contract</field>
      </block>
    </value>
    <value name="PREDICTION">
      <block type="variables_get" id="get_digit">
        <field name="VAR" id="v_chosen_digit">chosen_digit</field>
      </block>
    </value>
    <value name="AMOUNT">
      <block type="math_arithmetic" id="stake_calc">
        <field name="OP">MULTIPLY</field>
        <value name="A">
          <block type="variables_get" id="get_base">
            <field name="VAR" id="v_base_stake">base_stake</field>
          </block>
        </value>
        <value name="B">
          <block type="math_single" id="power_calc">
            <field name="OP">POW10</field>
            <value name="NUM">
              <block type="variables_get" id="get_recovery">
                <field name="VAR" id="v_current_recovery">current_recovery</field>
              </block>
            </value>
          </block>
        </value>
      </block>
    </value>
    <value name="DURATION">
      <block type="math_number" id="duration">
        <field name="NUM">1</field>
      </block>
    </value>
    <value name="DURATIONTYPE">
      <block type="durationtype" id="dur_type">
        <field name="DURATIONTYPE_LIST">t</field>
      </block>
    </value>
    <next>
      <block type="controls_if" id="if_recovery_check">
        <value name="IF0">
          <block type="logic_compare" id="recovery_comp">
            <field name="OP">EQ</field>
            <value name="A">
              <block type="variables_get" id="get_recovery2">
                <field name="VAR" id="v_current_recovery">current_recovery</field>
              </block>
            </value>
            <value name="B">
              <block type="math_number" id="zero">
                <field name="NUM">0</field>
              </block>
            </value>
          </block>
        </value>
        <statement name="DO0">
          <block type="procedures_callnoreturn" id="call_choose_best2">
            <mutation name="choose_best"></mutation>
          </block>
        </statement>
        <next>
          <block type="controls_if" id="if_recovery_check2">
            <value name="IF0">
              <block type="logic_compare" id="recovery_comp2">
                <field name="OP">GT</field>
                <value name="A">
                  <block type="variables_get" id="get_recovery3">
                    <field name="VAR" id="v_current_recovery">current_recovery</field>
                  </block>
                </value>
                <value name="B">
                  <block type="math_number" id="zero2">
                    <field name="NUM">0</field>
                  </block>
                </value>
              </block>
            </value>
            <statement name="DO0">
              <block type="procedures_callnoreturn" id="call_choose_next">
                <mutation name="choose_next_best"></mutation>
              </block>
            </statement>
          </block>
        </next>
      </block>
    </next>
  </block>

  <block type="after_purchase" id="after_purchase" x="8" y="900">
    <statement name="STACK">
      <block type="controls_if" id="if_win_loss">
        <mutation else="1"></mutation>
        <value name="IF0">
          <block type="contract_check_result" id="check_win">
            <field name="CHECK_RESULT_LIST">win</field>
          </block>
        </value>
        <statement name="DO0">
          <block type="variables_set" id="reset_recovery">
            <field name="VAR" id="v_current_recovery">current_recovery</field>
            <value name="VALUE">
              <block type="math_number" id="reset_zero">
                <field name="NUM">0</field>
              </block>
            </value>
            <next>
              <block type="variables_set" id="reset_digit">
                <field name="VAR" id="v_last_digit">last_digit</field>
                <value name="VALUE">
                  <block type="math_number" id="reset_digit_val">
                    <field name="NUM">-1</field>
                  </block>
                </value>
                <next>
                  <block type="variables_set" id="reset_side">
                    <field name="VAR" id="v_last_side">last_side</field>
                    <value name="VALUE">
                      <block type="text" id="reset_side_val">
                        <field name="TEXT"></field>
                      </block>
                    </value>
                  </block>
                </next>
              </block>
            </next>
          </block>
        </statement>
        <statement name="ELSE">
          <block type="variables_set" id="inc_recovery">
            <field name="VAR" id="v_current_recovery">current_recovery</field>
            <value name="VALUE">
              <block type="math_arithmetic" id="add_recovery">
                <field name="OP">ADD</field>
                <value name="A">
                  <block type="variables_get" id="get_recovery_add">
                    <field name="VAR" id="v_current_recovery">current_recovery</field>
                  </block>
                </value>
                <value name="B">
                  <block type="math_number" id="one">
                    <field name="NUM">1</field>
                  </block>
                </value>
              </block>
            </value>
            <next>
              <block type="variables_set" id="save_digit">
                <field name="VAR" id="v_last_digit">last_digit</field>
                <value name="VALUE">
                  <block type="variables_get" id="get_digit_save">
                    <field name="VAR" id="v_chosen_digit">chosen_digit</field>
                  </block>
                </value>
                <next>
                  <block type="variables_set" id="save_side">
                    <field name="VAR" id="v_last_side">last_side</field>
                    <value name="VALUE">
                      <block type="controls_if" id="if_over_under">
                        <mutation else="1"></mutation>
                        <value name="IF0">
                          <block type="logic_compare" id="comp_over">
                            <field name="OP">EQ</field>
                            <value name="A">
                              <block type="variables_get" id="get_contract_check">
                                <field name="VAR" id="v_chosen_contract">chosen_contract</field>
                              </block>
                            </value>
                            <value name="B">
                              <block type="text" id="text_over">
                                <field name="TEXT">DIGITOVER</field>
                              </block>
                            </value>
                          </block>
                        </value>
                        <statement name="DO0">
                          <block type="text" id="text_over_result">
                            <field name="TEXT">OVER</field>
                          </block>
                        </statement>
                        <statement name="ELSE">
                          <block type="text" id="text_under_result">
                            <field name="TEXT">UNDER</field>
                          </block>
                        </statement>
                      </block>
                    </value>
                  </block>
                </next>
              </block>
            </next>
          </block>
        </statement>
        <next>
          <block type="controls_if" id="if_session_limit">
            <mutation elseif="1"></mutation>
            <value name="IF0">
              <block type="logic_compare" id="comp_session">
                <field name="OP">LT</field>
                <value name="A">
                  <block type="math_arithmetic" id="session_calc">
                    <field name="OP">MINUS</field>
                    <value name="A">
                      <block type="balance" id="current_balance">
                      </block>
                    </value>
                    <value name="B">
                      <block type="variables_get" id="get_start_bal">
                        <field name="VAR" id="v_start_bal">starting_balance</field>
                      </block>
                    </value>
                  </block>
                </value>
                <value name="B">
                  <block type="variables_get" id="get_session_limit">
                    <field name="VAR" id="v_session_loss_limit">session_loss_limit</field>
                  </block>
                </value>
              </block>
            </value>
            <statement name="DO0">
              <block type="notify" id="notify_session">
                <field name="MESSAGE_TYPE">success</field>
                <value name="MESSAGE">
                  <block type="text" id="text_session">
                    <field name="TEXT">Session loss limit reached. Bot stopped.</field>
                  </block>
                </value>
                <next>
                  <block type="trade_again" id="stop_session">
                    <field name="TRADE_AGAIN">false</field>
                  </block>
                </next>
              </block>
            </statement>
            <value name="IF1">
              <block type="logic_compare" id="comp_max_recovery">
                <field name="OP">GTE</field>
                <value name="A">
                  <block type="variables_get" id="get_recovery_max">
                    <field name="VAR" id="v_current_recovery">current_recovery</field>
                  </block>
                </value>
                <value name="B">
                  <block type="variables_get" id="get_max_recovery">
                    <field name="VAR" id="v_max_recoveries">max_recoveries</field>
                  </block>
                </value>
              </block>
            </value>
            <statement name="DO1">
              <block type="notify" id="notify_max">
                <field name="MESSAGE_TYPE">success</field>
                <value name="MESSAGE">
                  <block type="text" id="text_max">
                    <field name="TEXT">Maximum recoveries reached. Bot stopped.</field>
                  </block>
                </value>
                <next>
                  <block type="trade_again" id="stop_max">
                    <field name="TRADE_AGAIN">false</field>
                  </block>
                </next>
              </block>
            </statement>
          </block>
        </next>
      </block>
    </statement>
  </block>
</xml>
